<html data-slide=0>
<title>Learning from Machines</title>
<link rel=stylesheet href=base.less>
<link rel=stylesheet href=title.less>
<link rel=stylesheet href=hallucinations.less>

<script src=typewriter.js></script>
<script src=type-writer.js></script>
<script src=main.js></script>

<body>
  <div id=titleCard class=vbox>
    <type-writer id=titleWriter></type-writer>
  </div>
  <script>
    // const titleWriter = new Typewriter(title, '')
    Builds(
      titleWriter.type('')
      , titleWriter.type('learning from machines')
      , titleWriter.erase()
      , titleWriter.type('1. ')
      , titleWriter.type('hallucinations')
      , titleWriter.erase()
    )
  </script>
  <div id=hallucinations class=seed>
    <img id=inceptionDiagram src=inception-diagram.svg>
    <div id=deepDreamOutputLayer>
      <span class=P>cat</span>
      <span class=P>dog</span>
      <span class=P>person</span>
      <span class=P>banana</span>
      <span class=P>toaster</span>
      </div>
    <video id=deepDream src=miquel_pn_deep_dream.mp4></video>
    <h1 id=miquel></h1>
    <div id=deepDreamLayers class=stopped>
        <h1 id=deepDreamCurrentLayer></h1>
      </div>        
    <div id=deepDreamInputLayer>
      <canvas id=deepDreamInputPixels></canvas>
    </div>
    <div id=deepDreamInputLayerReceptiveField>
      <div id=deepDreamReceptiveFieldHighlight></div>
    </div>
    <div id=deepDreamConvOutput>
      <script>
        for (let r = 0; r !== 5; ++r) {
          document.write(`<div class="row row-${r}">`)
          for (let c = 0; c !== 5; ++c) {
            document.write(`<div class="cell cell-${r}-${c}"></div>`)
          }
          document.write(`</div>`)
        }
      </script>
    </div>
    <pre id=deepDreamConvFilter></pre>
    <script>
      const layers = ["Initial input data", "conv1/7x7_s2", "pool1/3x3_s2", "pool1/norm1", "conv2/3x3_reduce", "conv2/3x3", "conv2/norm2", "pool2/3x3_s2", "inception_3a/1x1", "inception_3a/3x3_reduce", "inception_3a/3x3", "inception_3a/5x5_reduce", "inception_3a/5x5", "inception_3a/pool", "inception_3a/pool_proj", "inception_3a/output", "inception_3b/1x1", "inception_3b/3x3_reduce", "inception_3b/3x3", "inception_3b/5x5_reduce", "inception_3b/5x5", "inception_3b/pool", "inception_3b/pool_proj", "inception_3b/output", "pool3/3x3_s2", "inception_4a/1x1", "inception_4a/3x3_reduce", "inception_4a/3x3", "inception_4a/5x5_reduce", "inception_4a/5x5", "inception_4a/pool", "inception_4a/pool_proj", "inception_4a/output", "inception_4b/1x1", "inception_4b/3x3_reduce", "inception_4b/3x3", "inception_4b/5x5_reduce", "inception_4b/5x5", "inception_4b/pool", "inception_4b/pool_proj", "inception_4b/output", "inception_4c/1x1", "inception_4c/3x3_reduce", "inception_4c/3x3", "inception_4c/5x5_reduce", "inception_4c/5x5", "inception_4c/pool", "inception_4c/pool_proj", "inception_4c/output", "inception_4d/1x1", "inception_4d/3x3_reduce", "inception_4d/3x3", "inception_4d/5x5_reduce", "inception_4d/5x5", "inception_4d/pool", "inception_4d/pool_proj", "inception_4d/output", "inception_4e/1x1", "inception_4e/3x3_reduce", "inception_4e/3x3", "inception_4e/5x5_reduce", "inception_4e/5x5", "inception_4e/pool", "inception_4e/pool_proj", "inception_4e/output", "pool4/3x3_s2", "inception_5a/1x1", "inception_5a/3x3_reduce", "inception_5a/3x3", "inception_5a/5x5_reduce", "inception_5a/5x5", "inception_5a/pool", "inception_5a/pool_proj", "inception_5a/output", "inception_5b/1x1", "inception_5b/3x3_reduce", "inception_5b/3x3", "inception_5b/5x5_reduce", "inception_5b/5x5", "inception_5b/pool", "inception_5b/pool_proj", "inception_5b/output", "pool5/7x7_s1"]      
      deepDream.onloadedmetadata = () => {
        const timeAtEachLayer = deepDream.duration / layers.length
        deepDream.timeline = Timeline(
            layers.map((layer, i) => ({
              at: i * timeAtEachLayer, layer
            }))
          )
      }
    </script>
    <script src=inception.js></script>
  </div>
  <build-note id="titleBlank"></build-note>
  <build-note id="titleLfm"></build-note>
  <build-note id="titleLfmErased"></build-note>
  <build-note id="titleHallucinations"></build-note>
  <build-note id="dreamFullscreenPaused"></build-note>
  <build-note id="dreamFullscreenMiquel"></build-note>
  <build-note id="inception"></build-note>


  <script>
    When(buildInRange(titleBlank, titleLfmErased))
      .frame(() => {
        if (!deepDream.timeline) return
        deepDreamCurrentLayer.textContent = deepDream.timeline(deepDream).layer
      })
  </script>
  
  <script>
    const trip = new CSSBuilds(hallucinations)
    const video = new Playback(deepDream, {playing: false, currentTime: 0})
    const inceptionViz = new InceptionViz(deepDream, deepDreamInputPixels)
    const ddFilter = new Typewriter(deepDreamConvFilter, '', {typingRate: 128, eraseRate: 256})
    const layersView = new Daemon({
      atStart() {},
      atFrame(ts) {
        if (!deepDream.timeline) return
        deepDreamCurrentLayer.textContent = deepDream.timeline(deepDream).layer
        return true
      },
      atEnd() {}
    })

    const randomRow = w => () => new Array(w).fill(0)
      .map((() => Math.random().toString().substr(0, 3) + ' '))
      .join('') + '\n'
    const randomMatrix = (w, h) =>
      '[\n' + new Array(h).fill(0).map(randomRow(w)).join('') + ']'

    const twMiquel = new Typewriter(miquel, '')

    Builds(
      [trip.setClass('fullscreen')]
      , [trip.setClass('fullscreen-with-miquel'), twMiquel.type('Miquel Perell√≥ Nieto')]
      , video.play()
      , trip.setClass('fullscreen')
      , [trip.setClass('fullscreen-with-layer'), layersView.start()]
      , trip.setClass('inception')
      , [trip.setClass('inception-from-input'), inceptionViz.start()]
      , trip.setClass('inception-to-output')
      , trip.setClass('inception-conv')
      , trip.setClass('inception-conv-forward')
      , trip.setClass('inception-training')
      , [ddFilter.erase(), ddFilter.type(randomMatrix(3, 3))]
      , [ddFilter.erase(), ddFilter.type(randomMatrix(3, 3))]
      , [ddFilter.erase(), ddFilter.type(randomMatrix(3, 3))]
      , [trip.setClass('inception-incepting'), ddFilter.type('.ascendGradient()')]
      , trip.setClass('pan-diagram')
      , [layersView.stop(), inceptionViz.stop(), trip.setClass('inception')]
      , trip.setClass('fullscreen')
    )
  </script>
</body>